<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>Redis | Daniel·young</title><meta name="description" content="Redis学习"><meta property="og:type" content="article"><meta property="og:title" content="Redis"><meta property="og:url" content="http://example.com/2019/10/02/Redis/index.html"><meta property="og:site_name" content="Daniel·young"><meta property="og:description" content="Redis学习"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-10-02T02:11:31.000Z"><meta property="article:modified_time" content="2022-07-19T07:25:46.858Z"><meta property="article:tag" content="Redis"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://example.com/2019/10/02/Redis/index.html"><link rel="alternate" href="/atom.xml" title="Daniel·young" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/ymagic" target="_blank"><img class="img-circle" src="/images/avatar.png" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Daniel·young</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">随手记录自己的学习过程</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/ymagic" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/%E7%BC%93%E5%AD%98/">缓存</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringBoot/">SpringBoot</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/%E7%AC%94%E8%AE%B0/">笔记</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/homebrew/">homebrew</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java-8/">java 8</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mac/openjdk/">openjdk</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/">mac快捷键</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/iTerm2/">iTerm2</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/idea/">idea</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/sql%E4%BC%98%E5%8C%96/">sql优化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/">流量控制</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/%E9%99%90%E6%B5%81/">限流</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%9F%A5%E8%AF%86%E7%82%B9/">知识点</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/">排序</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%93%E5%AD%98/">缓存</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quartz/" rel="tag">Quartz</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/" rel="tag">Ubuntu</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hex/" rel="tag">hex</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iTerm2/" rel="tag">iTerm2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/idea/" rel="tag">idea</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java8/" rel="tag">java8</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/" rel="tag">mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/" rel="tag">mac快捷键</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nacos/" rel="tag">nacos</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openjdk/" rel="tag">openjdk</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql%E4%BC%98%E5%8C%96/" rel="tag">sql优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag">单例模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/" rel="tag">流量控制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" rel="tag">知识点</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%93%E5%AD%98/" rel="tag">缓存</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%95%9C%E5%83%8F/" rel="tag">镜像</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%99%90%E6%B5%81/" rel="tag">限流</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/Lambda/" style="font-size:13px">Lambda</a> <a href="/tags/Quartz/" style="font-size:13px">Quartz</a> <a href="/tags/Redis/" style="font-size:13px">Redis</a> <a href="/tags/SpringBoot/" style="font-size:13px">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size:13px">SpringCloud</a> <a href="/tags/Ubuntu/" style="font-size:14px">Ubuntu</a> <a href="/tags/docker/" style="font-size:14px">docker</a> <a href="/tags/hex/" style="font-size:13px">hex</a> <a href="/tags/homebrew/" style="font-size:13px">homebrew</a> <a href="/tags/iTerm2/" style="font-size:13px">iTerm2</a> <a href="/tags/idea/" style="font-size:13px">idea</a> <a href="/tags/java8/" style="font-size:13px">java8</a> <a href="/tags/mac/" style="font-size:13px">mac</a> <a href="/tags/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/" style="font-size:14px">mac快捷键</a> <a href="/tags/nacos/" style="font-size:13px">nacos</a> <a href="/tags/openjdk/" style="font-size:13px">openjdk</a> <a href="/tags/sql%E4%BC%98%E5%8C%96/" style="font-size:13px">sql优化</a> <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" style="font-size:13px">单例模式</a> <a href="/tags/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6/" style="font-size:13px">流量控制</a> <a href="/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/" style="font-size:13px">知识点</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size:13px">笔记</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:13px">算法</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size:13px">缓存</a> <a href="/tags/%E9%95%9C%E5%83%8F/" style="font-size:13px">镜像</a> <a href="/tags/%E9%99%90%E6%B5%81/" style="font-size:13px">限流</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E7%BC%93%E5%AD%98/">缓存</a></p><p class="item-title"><a href="/2022/04/25/%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%E3%80%81%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9/" class="title">缓存击穿、穿透和雪崩</a></p><p class="item-date"><time datetime="2022-04-25T12:05:01.000Z" itemprop="datePublished">2022-04-25</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/homebrew/">homebrew</a></p><p class="item-title"><a href="/2022/01/21/homebrew/" class="title">homebrew</a></p><p class="item-date"><time datetime="2022-01-21T03:28:50.000Z" itemprop="datePublished">2022-01-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/mac/">mac</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/mac/openjdk/">openjdk</a></p><p class="item-title"><a href="/2021/12/08/mac%E5%AE%89%E8%A3%85openjdk17/" class="title">mac安装openjdk17</a></p><p class="item-date"><time datetime="2021-12-08T15:45:03.000Z" itemprop="datePublished">2021-12-08</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/">mac快捷键</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/iTerm2/">iTerm2</a></p><p class="item-title"><a href="/2021/10/21/mac%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%B9%8BiTerm2%E7%AF%87/" class="title">mac快捷键之iTerm2篇</a></p><p class="item-date"><time datetime="2021-10-21T03:28:50.000Z" itemprop="datePublished">2021-10-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/">mac快捷键</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/mac%E5%BF%AB%E6%8D%B7%E9%94%AE/idea/">idea</a></p><p class="item-title"><a href="/2021/10/21/mac%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%B9%8Bidea%E7%AF%87/" class="title">mac快捷键之idea篇</a></p><p class="item-date"><time datetime="2021-10-21T03:16:40.000Z" itemprop="datePublished">2021-10-21</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse in" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><nav id="toc" class="article-toc"><h3 class="toc-title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-%E7%89%B9%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">Redis 特点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-%E4%BC%98%E5%8A%BF"><span class="toc-number">2.</span> <span class="toc-text">Redis 优势</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#string%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">3.</span> <span class="toc-text">String(字符串)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.1.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#list%E5%88%97%E8%A1%A8"><span class="toc-number">4.</span> <span class="toc-text">list(列表)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="toc-number">4.1.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set%E9%9B%86%E5%90%88"><span class="toc-number">5.</span> <span class="toc-text">set(集合)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="toc-number">5.1.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hash%E6%95%A3%E5%88%97"><span class="toc-number">6.</span> <span class="toc-text">hash(散列)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="toc-number">6.1.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">7.</span> <span class="toc-text">zset(有序集合)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="toc-number">7.1.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-keys%E5%91%BD%E4%BB%A4"><span class="toc-number">8.</span> <span class="toc-text">Redis keys命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#string-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">9.</span> <span class="toc-text">String 操作命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#list-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">10.</span> <span class="toc-text">list 操作命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hash-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">11.</span> <span class="toc-text">hash 操作命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#set-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">12.</span> <span class="toc-text">set 操作命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sorted-set-%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="toc-number">13.</span> <span class="toc-text">sorted set 操作命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">14.</span> <span class="toc-text">持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#rdb"><span class="toc-number">14.1.</span> <span class="toc-text">RDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">14.1.1.</span> <span class="toc-text">恢复数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rdbde%E7%9A%84%E4%BC%98%E5%8A%BF%E5%92%8C%E5%8A%A3%E5%8A%BF"><span class="toc-number">14.1.2.</span> <span class="toc-text">RDBDE的优势和劣势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aof"><span class="toc-number">14.2.</span> <span class="toc-text">AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#aof%E9%85%8D%E7%BD%AE"><span class="toc-number">14.2.1.</span> <span class="toc-text">AOF配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AFaof"><span class="toc-number">14.2.2.</span> <span class="toc-text">开启AOF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aof%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D"><span class="toc-number">14.2.3.</span> <span class="toc-text">AOF文件恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aof%E9%87%8D%E5%86%99"><span class="toc-number">14.2.4.</span> <span class="toc-text">AOF重写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aof%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">14.2.5.</span> <span class="toc-text">AOF优缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E9%9B%86%E7%BE%A4"><span class="toc-number">14.2.6.</span> <span class="toc-text">Redis集群</span></a></li></ol></li></ol></li></ol></nav></div></aside><main class="main" role="main"><div class="content"><article id="post-Redis" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">Redis</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2019/10/02/Redis/" class="article-date"><time datetime="2019-10-02T02:11:31.000Z" itemprop="datePublished">2019-10-02</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/Redis/">Redis</a>►<a class="article-category-link" href="/categories/Redis/%E7%BC%93%E5%AD%98/">缓存</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/Redis/" rel="tag">Redis</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/10/02/Redis/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 7k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 25(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="redis-特点"><a class="markdownIt-Anchor" href="#redis-特点"></a> Redis 特点</h1><p>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。<br>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。<br>Redis支持数据的备份，即master-slave模式的数据备份。</p><h1 id="redis-优势"><a class="markdownIt-Anchor" href="#redis-优势"></a> Redis 优势</h1><p>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。<br>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。<br>原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。<br>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p><p>Redis value的数据结构 String、Hash、List、Set、ZSet</p><h1 id="string字符串"><a class="markdownIt-Anchor" href="#string字符串"></a> String(字符串)</h1><ul><li>存储最简单的key-value结构</li><li>value可以是字符串、整数或者浮点型</li><li>可以对整个字符串或者字符串的一部分执行操作</li><li>对整数和浮点数执行自增或自减操作</li></ul><h2 id="使用场景"><a class="markdownIt-Anchor" href="#使用场景"></a> 使用场景</h2><ul><li>常规key-value缓存应用</li><li>分布式id生成器</li></ul><h1 id="list列表"><a class="markdownIt-Anchor" href="#list列表"></a> list(列表)</h1><ul><li>一个链表，链表上的每各节点都包含了一个字符串，字符串可以重复</li><li>可以从链表的两端推入或者拉出元素</li><li>根据偏移量对链表进行修剪</li><li>读取单个或者多个元素</li><li>根据值查找或者移除元素</li></ul><h2 id="使用场景-2"><a class="markdownIt-Anchor" href="#使用场景-2"></a> 使用场景</h2><ul><li>最新消息排行等功能</li><li>消息队列</li><li>关注列表，粉丝列表</li></ul><h1 id="set集合"><a class="markdownIt-Anchor" href="#set集合"></a> set(集合)</h1><ul><li>包含字符串的无序收集器，并且被包含的每个字符串都是独一无二，各不相同的，即不能重复</li><li>可以添加、获取、移除单个元素</li><li>检查一个元素是否存在于集合中</li><li>计算交集、并集、差集</li><li>从集合里面随机获取元素</li></ul><h2 id="使用场景-3"><a class="markdownIt-Anchor" href="#使用场景-3"></a> 使用场景</h2><ul><li>共同好友，共同喜好，二度好友</li><li>统计网站访问IP（利用唯一性，统计访问网站的所有独立IP）</li><li>好友推荐（好友推荐时，根据tag求交集，大于某个阈值就可以推荐）</li></ul><h1 id="hash散列"><a class="markdownIt-Anchor" href="#hash散列"></a> hash(散列)</h1><ul><li>是一个string类型的field和value的映射表</li><li>包含键值对的无序散列表，键不能重复</li><li>可以添加、获取、移除单个键值对</li><li>获取所有键值对</li></ul><h2 id="使用场景-4"><a class="markdownIt-Anchor" href="#使用场景-4"></a> 使用场景</h2><ul><li>hash特别适合用于存储对象</li><li>存储用户信息（能单独修改用户某一属性信息）</li></ul><h1 id="zset有序集合"><a class="markdownIt-Anchor" href="#zset有序集合"></a> zset(有序集合)</h1><ul><li>有序集合的键被称为成员，每个成员都是各不相同的</li><li>而有序集合的值被称为分值，分值必须为浮点数</li><li>有序集合是字符串成员与浮点数分值之间的有序映射，元素的排列顺序由分值的大小决定</li><li>可以添加、获取、删除单个元素</li><li>根据分值范围或者成员来获取元素</li><li>有序集合是redis里面唯一一个既可以根据成员访问元素（这一点和散列一样），又可以根据分值以及分值的排列顺序来访问元素的结构</li></ul><h2 id="使用场景-5"><a class="markdownIt-Anchor" href="#使用场景-5"></a> 使用场景</h2><ul><li>排行榜</li><li>带权重的消息队列</li></ul><h1 id="redis-keys命令"><a class="markdownIt-Anchor" href="#redis-keys命令"></a> Redis keys命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">del (key)   用于在key存在是删除key</span><br><span class="line"></span><br><span class="line">dump (key)   序列化给定的key,并返回被序列化的值</span><br><span class="line"></span><br><span class="line">exists (key)   检查给定的key是否存在</span><br><span class="line"></span><br><span class="line">expire (key seconds)  为给定key设置过期时间</span><br><span class="line"></span><br><span class="line">expire (key timestamp)    EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)</span><br><span class="line"></span><br><span class="line">pexpire (key milliseconds) 设置 key 的过期时间以毫秒计</span><br><span class="line"></span><br><span class="line">pexpiret (key milliseconds-timestamp)   设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</span><br><span class="line"></span><br><span class="line">keys (pattern)   查找所有符合给定模式( pattern)的 key</span><br><span class="line"></span><br><span class="line">move (key dbindex)   将当前数据库的 key 移动到有dbindex索引的数据库</span><br><span class="line"></span><br><span class="line">persist (key) 移除 key 的过期时间，key 将持久保持</span><br><span class="line"></span><br><span class="line">pttl (key) 以毫秒为单位返回 key 的剩余的过期时间。</span><br><span class="line"></span><br><span class="line">ttl (key) 以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)</span><br><span class="line"></span><br><span class="line">rename (key newkey) 修改 key 的名称</span><br><span class="line"></span><br><span class="line">renamenx (key newkey) 仅当 newkey 不存在时，将 key 改名为 newkey </span><br><span class="line"></span><br><span class="line">type (key) 返回key所储存的值的类型</span><br><span class="line"></span><br><span class="line">dbsize  返回当前数据库中的key的数目</span><br><span class="line"></span><br><span class="line">flushdb  删除当前选择数据库中所有key</span><br><span class="line"></span><br><span class="line">flushall  删除所有数据库中的所有key</span><br></pre></td></tr></table></figure><h1 id="string-操作命令"><a class="markdownIt-Anchor" href="#string-操作命令"></a> String 操作命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">set (key value)  设置给定key的value值</span><br><span class="line"></span><br><span class="line">get (key)  获取指定key的值</span><br><span class="line"></span><br><span class="line">setnx (key value)  只有在key不存在时设置key的值</span><br><span class="line"></span><br><span class="line">mset (key1 value1 key2 value2 ... keyn valuen)  同时设置一个或多个key-value值</span><br><span class="line"></span><br><span class="line">msetnx (key1 value1 key2 value2 ... keyn valuen) 所有给定 key 都不存在时，同时设置一个或多个 key-value 对</span><br><span class="line"></span><br><span class="line">setex (key timeout value) 给指定的key设置值及过期时间,单位：秒</span><br><span class="line"></span><br><span class="line">psetex (key milliseconds value) 给指定的key设置值及过期时间,单位：毫秒</span><br><span class="line"></span><br><span class="line">getrange (key start end) 获取存储在指定key中字符串的子字符串，字符串的截取范围由 start 和 end 两个偏移量决定(包括 start 和 end 在内)</span><br><span class="line"></span><br><span class="line">incr (key) 将key中存储的数字值增一，如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 incr 操作，如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误，本操作的值限制在 64 位(bit)有符号数字表示之内</span><br><span class="line"></span><br><span class="line">decr (key) 将key中存储的数字值减一，如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 decr 操作，如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误，本操作的值限制在 64 位(bit)有符号数字表示之内</span><br><span class="line"></span><br><span class="line">incrby (key incr_amount) 将 key 中储存的数字加上指定的增量值,如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 incrby 命令,如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误,本操作的值限制在 64 位(bit)有符号数字表示之内</span><br><span class="line"></span><br><span class="line">decrby (key decr_amount) 将 key 所储存的值减去指定的减量值,</span><br><span class="line">如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 decrby 操作,如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误,本操作的值限制在 64 位(bit)有符号数字表示之内</span><br><span class="line"></span><br><span class="line">incrbyfloat (key incr_amount) 为 key 中所储存的值加上指定的浮点数增量值,如果 key 不存在，那么 INCRBYFLOAT 会先将 key 的值设为 0 ，再执行加法操作</span><br><span class="line"></span><br><span class="line">strlen (key)  获取key所存储字符串值的长度，当 key 储存的不是字符串值时，返回一个错误</span><br><span class="line"></span><br><span class="line">setrange (key offset value) 用指定的字符串覆盖给定 key 所储存的字符串值，覆盖的位置从偏移量 offset 开始</span><br><span class="line"></span><br><span class="line">append (key value)  为指定的 key 追加值,如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾如果 key 不存在， APPEND 就简单地将给定 key 设为 value ，就像执行 SET key value 一样</span><br></pre></td></tr></table></figure><h1 id="list-操作命令"><a class="markdownIt-Anchor" href="#list-操作命令"></a> list 操作命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">rpush (key value1 ... valuen) 用于将一个或多个值插入到列表的尾部(最右边)</span><br><span class="line"></span><br><span class="line">lindex 通过索引获取列表中的元素，也可以使用负数下标，以 -1 表示列表的最后一个元素，-2 表示列表的倒数第二个元素，以此类推</span><br><span class="line"></span><br><span class="line">lrange (key start end)  返回列表中指定区间内的元素，区间以偏移量 START 和 END 指定。 其中 0 表示列表的第一个元素， 1 表示列表的第二个元素，以此类推。 你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推</span><br><span class="line"></span><br><span class="line">rpoplpush (source_key destination_key)  移除列表的最后一个元素，并将该元素添加到另一个列表并返回</span><br><span class="line"></span><br><span class="line">blpop (list1 list2 ... listn timeout)  移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line"></span><br><span class="line">brpop (list1 list2 ... listn timeout) 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line"></span><br><span class="line">brpoplpush (list another_list timeout)  从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</span><br><span class="line"></span><br><span class="line">lrem (key count value)  根据参数 COUNT 的值，移除列表中与参数 VALUE 相等的元素。COUNT 的值可以是以下几种：</span><br><span class="line">count &gt; 0 : 从表头开始向表尾搜索，移除与 VALUE 相等的元素，数量为 COUNT ,count &lt; 0 : 从表尾开始向表头搜索，移除与 VALUE 相等的元素，数量为 COUNT 的绝对值, count = 0 : 移除表中所有与 VALUE 相等的值</span><br><span class="line"></span><br><span class="line">llen (key) 用于返回列表的长度。 如果列表 key 不存在，则 key 被解释为一个空列表，返回 0 ,如果 key 不是列表类型，返回一个错误</span><br><span class="line"></span><br><span class="line">ltrim (key start stop) 对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。下标 0 表示列表的第一个元素，以 1 表示列表的第二个元素，以此类推。 你也可以使用负数下标，以 -1 表示列表的最后一个元素， -2 表示列表的倒数第二个元素，以此类推</span><br><span class="line"></span><br><span class="line">lpop (key) 用于移除并返回列表的第一个元素</span><br><span class="line"></span><br><span class="line">rpop (key) 用于移除并返回列表的最后一个元素</span><br><span class="line"></span><br><span class="line">lpushx (key value1 value2 ... valuen) 将一个或多个值插入到已存在的列表头部，列表不存在时操作无效</span><br><span class="line"></span><br><span class="line">rpushx (key value1 value2 ... valuen) 将一个或多个值插入到已存在的列表尾部(最右边)，列表不存在时操作无效</span><br><span class="line"></span><br><span class="line">linsert (key before|after ecisting_value new_value) 用于在列表的元素前或者后插入元素。当指定元素不存在于列表中时，不执行任何操作。当列表不存在时，被视为空列表，不执行任何操作。如果 key 不是列表类型，返回一个错误</span><br><span class="line"></span><br><span class="line">lset (key index value)  通过索引来设置元素的值,当索引参数超出范围，或对一个空列表进行 lset 时，返回一个错误</span><br></pre></td></tr></table></figure><h1 id="hash-操作命令"><a class="markdownIt-Anchor" href="#hash-操作命令"></a> hash 操作命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">hset (key field value)  为哈希表中的字段赋值，如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作，如果字段已经存在于哈希表中，旧值将被覆盖</span><br><span class="line"></span><br><span class="line">hsetnx (key field value)  为哈希表中不存在的的字段赋值 。如果哈希表不存在，一个新的哈希表被创建并进行 HSET 操作。如果字段已经存在于哈希表中，操作无效。如果 key 不存在，一个新哈希表被创建并执行 HSETNX 命令</span><br><span class="line"></span><br><span class="line">hget (key field_name) 用于返回哈希表中指定字段的值</span><br><span class="line"></span><br><span class="line">hgetall (key) 返回哈希表中所有的字段和值，返回值中紧跟每个字段名(field name)之后是字段的值(value)，所以返回值的长度是哈希表大小的两倍</span><br><span class="line"></span><br><span class="line">hmset (key field1 value1 filed2 value2 ... filedn valuen)  同时将多个field-value(字段-值)对设置到哈希表中，此命令会覆盖哈希表中已存在的字段，如果哈希表不存在，会创建一个空哈希表，并执行 HMSET 操作</span><br><span class="line"></span><br><span class="line">hmget (key field1 field2 ... fieldn)  用于返回哈希表中一个或多个给定字段的值，如果不存在，返回nil值</span><br><span class="line"></span><br><span class="line">hexists (key field)  查询hash表中指定字段是否存在</span><br><span class="line"></span><br><span class="line">hincrby (key field incr_by_number) 用于为哈希表中的字段值加上指定增量值。增量也可以为负数，相当于对指定字段进行减法操作。如果哈希表的 key 不存在，一个新的哈希表被创建并执行 hincrby 命令。如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 。对一个储存字符串值的字段执行 HINCRBY 命令将造成一个错误</span><br><span class="line"></span><br><span class="line">hincrbyfloat (key field incr_by_number)  用于为哈希表中的字段值加上指定浮点数增量值.如果指定的字段不存在，那么在执行命令前，字段的值被初始化为 0 </span><br><span class="line"></span><br><span class="line">hlen (key)  获取哈希表中字段的数量</span><br><span class="line"></span><br><span class="line">hdel (key field1 field2 ... fieldn) 用于删除哈希表 key 中的一个或多个指定字段，不存在的字段将被忽略</span><br><span class="line"></span><br><span class="line">hvals (key)  返回哈希表所有字段的值</span><br><span class="line"></span><br><span class="line">hkeys (key)  获取哈希表中的所有字段名</span><br></pre></td></tr></table></figure><h1 id="set-操作命令"><a class="markdownIt-Anchor" href="#set-操作命令"></a> set 操作命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sscan (key [match pattern] [count countnum]) 迭代集合键中的元素</span><br><span class="line"></span><br><span class="line">sadd (key value1 ... valuen) 将一个或多个元素加入到集合</span><br><span class="line"></span><br><span class="line">srem (key value1 ... valuen) 移除集合中的一个或多个成员元素，不存在的成员元素会被忽略</span><br><span class="line"></span><br><span class="line">smembers (key)  返回集合中的所有成员，不存在的集合可以视为空集合</span><br><span class="line"></span><br><span class="line">scard (key) 返回集合中的元素数量</span><br><span class="line"></span><br><span class="line">sismember (key value) 判断成员是否是集合成员</span><br><span class="line"></span><br><span class="line">sunion (key1 key2 ... keyn) 返回指定集合的并集</span><br><span class="line"></span><br><span class="line">sunionstore (destination_key key1 key2 ... keyn) 将给定集合的并集存储在指定的集合 destination 中</span><br><span class="line"></span><br><span class="line">sinter (key1 key2 ... keyn)  返回给定所有集合的交集，不存在的集合 key 被视为空集</span><br><span class="line"></span><br><span class="line">sinterstore (destination_key key1 key2 ... keyn) 将给定集合之间的交集存储在指定的集合中。如果指定的集合已经存在，则将其覆盖</span><br><span class="line"></span><br><span class="line">sdiff (key1 key2 ... keyn)  返回给定集合之间的差集</span><br><span class="line"></span><br><span class="line">sdiffstore (destination_key  key1 key2 ... keyn) 将给定集合之间的差集存储在指定的集合中。如果指定的集合 key 已存在，则会被覆盖</span><br><span class="line"></span><br><span class="line">spop (key) 用于移除并返回集合中的一个随机元素</span><br></pre></td></tr></table></figure><h1 id="sorted-set-操作命令"><a class="markdownIt-Anchor" href="#sorted-set-操作命令"></a> sorted set 操作命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">zcard (key) 计算集合中元素的数量</span><br><span class="line"></span><br><span class="line">zrange (key start stop [withscores])  返回有序集合中指定区域内的成员，按成员分数值递增排序，下标参数 start 和 stop 都以 0 为底，也就是说，以 0 表示有序集第一个成员，以 1 表示有序集第二个成员，以此类推，你也可以使用负数下标，以 -1 表示最后一个成员</span><br><span class="line"></span><br><span class="line">zrevrange (key start stop [withscores])  返回有序集合中指定区域内的成员，按成员分数值递减排序，下标参数 start 和 stop 都以 0 为底，也就是说，以 0 表示有序集第一个成员，以 1 表示有序集第二个成员，以此类推，你也可以使用负数下标，以 -1 表示最后一个成员</span><br><span class="line"></span><br><span class="line">zadd (key score1 value1 score2 value2 ... scoren valuen)  将一个或多个成员元素及其分数值加入到有序集当中,分数值可以是整数值或双精度浮点数</span><br><span class="line"></span><br><span class="line">acount (key min max) 计算有序集合中指定分数区间的成员数量</span><br><span class="line"></span><br><span class="line">zscore (key member) 返回有序集中，成员的分数值</span><br><span class="line"></span><br><span class="line">zincrby (key increment member) 对有序集合中指定成员的分数加上增量 increment,分数值可以是整数值或双精度浮点数,可正可负</span><br><span class="line"></span><br><span class="line">zrem (key member1 ... membern)  移除有序集中的一个或多个成员，不存在的成员将被忽略</span><br><span class="line"></span><br><span class="line">zrangebyscore (key min max [withscores] [limit offset count])  返回有序集合中指定分数区间的成员列表。有序集成员按分数值递增(从小到大)次序排列,默认情况下，区间的取值使用闭区间 (小于等于或大于等于)，你也可以通过给参数前增加 ( 符号来使用可选的开区间 (小于或大于) 例：zrangebyscore zset (1 5    1&lt;score&lt;=5     zrangebyscore zset -inf +inf 显示整个有序集</span><br><span class="line"></span><br><span class="line">zremrangebyscore (key min max) 移除有序集中，指定分数（score）区间内的所有成员</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -n 100000 -q    同时执行10万个请求测试性能</span><br></pre></td></tr></table></figure><h1 id="持久化"><a class="markdownIt-Anchor" href="#持久化"></a> 持久化</h1><h2 id="rdb"><a class="markdownIt-Anchor" href="#rdb"></a> RDB</h2><p>RDB是Redis用来进行持久化的一种方式，是把当前内存中的数据集快照写入磁盘，也就是 Snapshot 快照（数据库中所有键值对数据）。恢复时是将快照文件直接读到内存里<br>触发方式：自动触发和手动触发<br>自动触发：在 redis.conf 配置文件中的 SNAPSHOTTING 下</p><ul><li>save：这里是用来配置触发 Redis的持久化条件，也就是什么时候将内存中的数据保存到硬盘。默认如下配置：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1：表示900 秒内如果至少有 1 个 key 的值变化，则保存</span><br><span class="line">save 300 10：表示300 秒内如果至少有 10 个 key 的值变化，则保存</span><br><span class="line">save 60 10000：表示60 秒内如果至少有 10000 个 key 的值变化，则保存</span><br></pre></td></tr></table></figure><p>当然如果你只是用Redis的缓存功能，不需要持久化，那么你可以注释掉所有的 save 行来停用保存功能。可以直接一个空字符串来实现停用：save “”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli config set save &quot; &quot;</span><br></pre></td></tr></table></figure><ul><li>stop-writes-on-bgsave-error ：默认值为yes。当启用了RDB且最后一次后台保存数据失败，Redis是否停止接收数据。这会让用户意识到数据没有正确持久化到磁盘上，否则没有人会注意到灾难（disaster）发生了。如果Redis重启了，那么又可以重新开始接收数据了</li><li>rdbcompression ；默认值是yes。对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能，但是存储在磁盘上的快照会比较大。</li><li>rdbchecksum ：默认值是yes。在存储快照后，我们还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能</li><li>dbfilename ：设置快照的文件名，默认是 dump.rdb</li><li>dir：设置快照文件的存放路径，这个配置项一定是个目录，而不能是文件名。使用上面的 dbfilename 作为保存的文件名<br>也就是说通过在配置文件中配置的 save 方式，当实际操作满足该配置形式时就会进行 RDB 持久化，将当前的内存快照保存在 dir 配置的目录中，文件名由配置的 dbfilename 决定</li></ul><h3 id="恢复数据"><a class="markdownIt-Anchor" href="#恢复数据"></a> 恢复数据</h3><p>将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可，redis就会自动加载文件数据至内存了。Redis 服务器在载入 RDB 文件期间，会一直处于阻塞状态，直到载入工作完成为止</p><h3 id="rdbde的优势和劣势"><a class="markdownIt-Anchor" href="#rdbde的优势和劣势"></a> RDBDE的优势和劣势</h3><p>优势：</p><ul><li>RDB是一个非常紧凑(compact)的文件，它保存了redis 在某个时间点上的数据集。这种文件非常适合用于进行备份和灾难恢复。</li><li>生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。</li><li>RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。</li></ul><p>劣势：</p><ul><li>RDB方式数据没办法做到实时持久化/秒级持久化。因为bgsave每次运行都要执行fork操作创建子进程，属于重量级操作(内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑)，频繁执行成本过高(影响性能)</li><li>RDB文件使用特定二进制格式保存，Redis版本演进过程中有多个格式的RDB版本，存在老版本Redis服务无法兼容新版RDB格式的问题(版本不兼容)</li><li>在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改(数据有丢失)</li></ul><h2 id="aof"><a class="markdownIt-Anchor" href="#aof"></a> AOF</h2><p>AOF是通过保存Redis服务器所执行的写命令来记录数据库状态</p><h3 id="aof配置"><a class="markdownIt-Anchor" href="#aof配置"></a> AOF配置</h3><p>在 redis.conf 配置文件的 APPEND ONLY MODE 下：</p><ul><li>appendonly：默认值为no，也就是说redis 默认使用的是rdb方式持久化，如果想要开启 AOF 持久化方式，需要将 appendonly 修改为 yes。</li><li>appendfilename ：aof文件名，默认是&quot;appendonly.aof&quot;</li><li>appendfsync：aof持久化策略的配置；</li></ul><ol><li>no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快，但是不太安全；</li><li>always表示每次写入都执行fsync，以保证数据同步到磁盘，效率很低；</li><li>everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。通常选择 everysec ，兼顾安全性和效率。</li></ol><ul><li>no-appendfsync-on-rewrite：在aof重写或者写入rdb文件的时候，会执行大量IO，此时对于everysec和always的aof模式来说，执行fsync会造成阻塞过长时间，no-appendfsync-on-rewrite字段设置为默认设置为no。如果对延迟要求很高的应用，这个字段可以设置为yes，否则还是设置为no，这样对持久化特性来说这是更安全的选择。 设置为yes表示rewrite期间对新写操作不fsync,暂时存在内存中,等rewrite完成后再写入，默认为no，建议yes。Linux的默认fsync策略是30秒。可能丢失30秒数据。默认值为no。</li><li>auto-aof-rewrite-percentage：默认值为100。aof自动重写配置，当目前aof文件大小超过上一次重写的aof文件大小的百分之多少进行重写，即当aof文件增长到一定大小的时候，Redis能够调用bgrewriteaof对日志文件进行重写。当前AOF文件大小是上次日志重写得到AOF文件大小的二倍（设置为100）时，自动启动新的日志重写过程。</li><li>auto-aof-rewrite-min-size：64mb。设置允许重写的最小aof文件大小，避免了达到约定百分比但尺寸仍然很小的情况还要重写。</li><li>aof-load-truncated：aof文件可能在尾部是不完整的，当redis启动的时候，aof文件的数据被载入内存。重启可能发生在redis所在的主机操作系统宕机后，尤其在ext4文件系统没有加上data=ordered选项，出现这种现象 redis宕机或者异常终止不会造成尾部不完整现象，可以选择让redis退出，或者导入尽可能多的数据。如果选择的是yes，当截断的aof文件被导入的时候，会自动发布一个log给客户端然后load。如果是no，用户必须手动redis-check-aof修复AOF文件才可以。默认值为 yes。</li></ul><h3 id="开启aof"><a class="markdownIt-Anchor" href="#开启aof"></a> 开启AOF</h3><p>将 redis.conf 的 appendonly 配置改为 yes 即可。<br>AOF 保存文件的位置和 RDB 保存文件的位置一样，都是通过 redis.conf 配置文件的 dir 配置,可以通过 config get dir 命令获取保存的路径</p><h3 id="aof文件恢复"><a class="markdownIt-Anchor" href="#aof文件恢复"></a> AOF文件恢复</h3><p>重启 Redis 之后就会进行 AOF 文件的载入。<br>异常修复命令：redis-check-aof --fix 进行修复</p><h3 id="aof重写"><a class="markdownIt-Anchor" href="#aof重写"></a> AOF重写</h3><p>由于AOF持久化是Redis不断将写命令记录到 AOF 文件中，随着Redis不断的进行，AOF 的文件会越来越大，文件越大，占用服务器内存越大以及 AOF 恢复要求时间越长。为了解决这个问题，Redis新增了重写机制，当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩，只保留可以恢复数据的最小指令集。可以使用命令 bgrewriteaof 来重写<br>AOF 文件重写并不是对原文件进行重新整理，而是直接读取服务器现有的键值对，然后用一条命令去代替之前记录这个键值对的多条命令，生成一个新的文件后去替换原来的 AOF 文件<br>AOF 文件重写触发机制：通过 redis.conf 配置文件中的 auto-aof-rewrite-percentage：默认值为100，以及auto-aof-rewrite-min-size：64mb 配置，也就是说默认Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发。<br>这里再提一下，我们知道 Redis 是单线程工作，如果 重写 AOF 需要比较长的时间，那么在重写 AOF 期间，Redis将长时间无法处理其他的命令，这显然是不能忍受的。Redis为了克服这个问题，解决办法是将 AOF 重写程序放到子程序中进行，这样有两个好处：<br>1.子进程进行 AOF 重写期间，服务器进程（父进程）可以继续处理其他命令。<br>2.子进程带有父进程的数据副本，使用子进程而不是线程，可以在避免使用锁的情况下，保证数据的安全性<br>使用子进程解决了上面的问题，但是新问题也产生了：因为子进程在进行 AOF 重写期间，服务器进程依然在处理其它命令，这新的命令有可能也对数据库进行了修改操作，使得当前数据库状态和重写后的 AOF 文件状态不一致。<br>为了解决这个数据状态不一致的问题，Redis 服务器设置了一个 AOF 重写缓冲区，这个缓冲区是在创建子进程后开始使用，当Redis服务器执行一个写命令之后，就会将这个写命令也发送到 AOF 重写缓冲区。当子进程完成 AOF 重写之后，就会给父进程发送一个信号，父进程接收此信号后，就会调用函数将 AOF 重写缓冲区的内容都写到新的 AOF 文件中。<br>这样将 AOF 重写对服务器造成的影响降到了最低</p><h3 id="aof优缺点"><a class="markdownIt-Anchor" href="#aof优缺点"></a> AOF优缺点</h3><p>优点：</p><ol><li>AOF 持久化的方法提供了多种的同步频率，即使使用默认的同步频率每秒同步一次，Redis 最多也就丢失 1 秒的数据而已。</li><li>AOF 文件使用 Redis 命令追加的形式来构造，因此，即使 Redis 只能向 AOF 文件写入命令的片断，使用 redis-check-aof 工具也很容易修正 AOF 文件。</li><li>AOF 文件的格式可读性较强，这也为使用者提供了更灵活的处理方式。例如，如果我们不小心错用了 FLUSHALL 命令，在重写还没进行时，我们可以手工将最后的 FLUSHALL 命令去掉，然后再使用 AOF 来恢复数据。</li></ol><p>缺点：</p><ol><li>对于具有相同数据的的 Redis，AOF 文件通常会比 RDF 文件体积更大。</li><li>虽然 AOF 提供了多种同步的频率，默认情况下，每秒同步一次的频率也具有较高的性能。但在 Redis 的负载较高时，RDB 比 AOF 具好更好的性能保证。</li><li>RDB 使用快照的形式来持久化整个 Redis 数据，而 AOF 只是将每次执行的命令追加到 AOF 文件中，因此从理论上说，RDB 比 AOF 方式更健壮。官方文档也指出，AOF 的确也存在一些 BUG，这些 BUG 在 RDB 没有存在。</li></ol><h3 id="redis集群"><a class="markdownIt-Anchor" href="#redis集群"></a> Redis集群</h3><p>集群命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a 123456 --cluster create 172.17.114.46:6000 172.17.114.46:6001 172.17.114.46:6002 172.17.114.46:6003 172.17.114.46:6004 172.17.114.46:6005 --cluster-replicas 1</span><br></pre></td></tr></table></figure></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://example.com/2019/10/02/Redis/" title="Redis" target="_blank" rel="external">http://example.com/2019/10/02/Redis/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote></div></article><section id="comments"></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2019/12/02/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5%E4%B9%8B%E9%99%90%E6%B5%81/" title="流量控制策略之限流"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2018/12/09/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="Lambda表达式"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li><li class="toggle-toc"><a class="toggle-btn" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button"><span>[&nbsp;</span><span>文章目录</span> <i class="text-collapsed icon icon-anchor"></i> <i class="text-in icon icon-close"></i> <span>]</span></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/ymagic" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>